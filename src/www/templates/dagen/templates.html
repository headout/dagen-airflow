{% extends base_template %}

{% block page_title %}DAG Templates
{% endblock %}

{% block head_css %}
{{ super() }}
    <style>
    span.highlighted {
        background: #F1C40F;
        display: inline-block;
        font-weight: bold;
        padding: 0 6px;
    }
</style>
{% endblock %}

{% block content %}
<h2>DAG Templates</h2>
<hr />

<div class="clearfix"></div>
<table class="table table-striped table-bordered table-hover model-list">
    <thead>
        <tr>
            <th class="col-md-1">&nbsp;</th>
            <th class="column-header">
                Template ID
            </th>
            <th class="column-header">
                Options
            </th>
        </tr>
    </thead>
    {% for tmpl in templates %}
    <tr>
        <td class="list-buttons-column">
            <a class="icon link-tooltip" href="graph?dag_name={{ dcmp_dag.conf.dag_name }}" title="Edit">
                <span class="fa fa-pencil glyphicon glyphicon-pencil" data-original-title="" title=""></span>
            </a>
            <a class="icon link-tooltip" href="details?dag_name={{ dcmp_dag.conf.dag_name }}" title="Details">
                <span class="fa fa-pencil glyphicon glyphicon-list" data-original-title="" title=""></span>
            </a>
            <a class="icon link-tooltip"
                href="compare?dag_name={{ dcmp_dag.dag_name }}&version1={{ dcmp_dag.version }}&version2={{ dcmp_dag.version }}"
                title="Compare">
                <span class="fa fa-pencil glyphicon glyphicon-duplicate" data-original-title="" title=""></span>
            </a>
            {% if can_access_approver %}
            <form class="icon" action="javascript:void(0)">
                <button class="delete-btn link-tooltip" dagname="{{ dcmp_dag.conf.dag_name }}" title="Delete">
                    <span class="fa fa-trash glyphicon glyphicon-trash"></span>
                </button>
            </form>
            {% if not dcmp_dag.editing and dcmp_dag.version != dcmp_dag.approved_version %}
            <a class="icon link-tooltip" href="approve?dag_name={{ dcmp_dag.conf.dag_name }}" title="Approve">
                <span class="fa fa-pencil glyphicon glyphicon-plane" data-original-title="" title=""></span>
            </a>
            {% endif %}
            {% endif %}
        </td>
        <td>
            {% if dcmp_dag.editing %}
            <span class="label" style="background-color:lime;"
                title="{{ dcmp_dag.editing_user_name }}{{ dcmp_dag.editing_start.strftime(' %Y-%m-%d %H:%M') if dcmp_dag.editing_start else '' }}">editing</span>
            {% elif dcmp_dag.version != dcmp_dag.approved_version %}
            {% if can_access_approver %}<a href="approve?dag_name={{ dcmp_dag.conf.dag_name }}"
                style="text-decoration: none;">{% endif %}<span class="label" style="background-color:gold;"
                    title="{{ dcmp_dag.last_editor_user_name }}{{ dcmp_dag.last_edited_at.strftime(' %Y-%m-%d %H:%M') if dcmp_dag.last_edited_at else '' }}">need
                    approve</span>{% if can_access_approver %}</a>{% endif %}
            {% else %}
            <span class="label" style="background-color:green;"
                title="{{ dcmp_dag.approver_user_name }}{{ dcmp_dag.last_approved_at.strftime(' %Y-%m-%d %H:%M') if dcmp_dag.last_approved_at else '' }}">published</span>
            {% endif %}
        </td>
        <td><a href="graph?dag_name={{ dcmp_dag.conf.dag_name }}&readonly=True" class="dag-name"
                dagname="{{ dcmp_dag.conf.dag_name }}">{{ dcmp_dag.conf.dag_name }}</a> <img class="loading"
                style="display: none;" width="15" src="{{ url_for("static", filename="loading.gif") }}"></td>
        <td>{{ dcmp_dag.conf.category }}</td>
        <td><span class="label label-default">{{ dcmp_dag.conf.cron }}</span></td>
        <td style="padding:0px; width:200px; height:10px;">
            <svg height="10" width="10" id='task-run-{{ dcmp_dag.conf.dag_name }}' style="display: block;"></svg>
        </td>
        </td>
        <td style="padding:0px; width:140px; height:10px;">
            <svg height="10" width="10" id='dag-run-{{ dcmp_dag.conf.dag_name }}' style="display: block;"></svg>
        </td>
        {% if search %}
        <td>
            {% for search_result in dcmp_dag.search_results %}
            <div {% if not loop.last %}style="margin-bottom: 5px;" {% endif %}>
                <a class="link-tooltip"
                    href="details?dag_name={{ dcmp_dag.conf.dag_name }}&highlight={{ search }}#{{ search_result['full_key'] }}"
                    title="View Record">
                    <span class="fa fa-pencil glyphicon glyphicon-search" data-original-title="" title=""></span>
                </a>
                {{ search_result["html_line"]|safe }}
                <!--
                    <a class="link-tooltip" href="raw?dag_name={{ dcmp_dag.conf.dag_name }}&highlight={{ search }}" title="Edit Record">
                      <span class="fa fa-pencil glyphicon glyphicon-pencil" data-original-title="" title=""></span>
                    </a>
-->
            </div>
            {% endfor %}
        </td>
        {% endif %}
    </tr>
    {% endfor %}
</table>
{% endblock %}
